FastClick.attach(document.body);$("header, #tiles *").attr("unselectable","on").css({"-moz-user-select":"-moz-none","-moz-user-select":"none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"}).bind("selectstart",function(){return false});var conf={level:{start:1,end:55,current:0},size:{start:2,end:8,current:0},tiles:{selector:"#tiles",width:320,margin:5,content:undefined},gap:{min:10,current:0},time:{max:60,current:0},score:0,combo:{max:0,current:0},debug:false,title:[[0,"색감 도전자"],[10,"색감 거지"],[20,"색감 노예"],[25,"색감 농노"],[30,"색감 소작농"],[34,"색감 평민"],[37,"색감 상인"],[39,"색감 도매상"],[41,"색감 사장"],[43,"색감 거상"],[45,"색감 장인"],[50,"색감 명인"],[55,"색감 명장"],[60,"색감 거장"],[65,"색감 기사"],[70,"색감 왕"],[75,"색감 대왕"],[80,"색감 황제"],[90,"색감 신"]]};function init(){conf.tiles.content=$(conf.tiles.selector);conf.tiles.content.empty();conf.tiles.width=conf.tiles.content.width();conf.tiles.content.css("height",conf.tiles.width+"px");conf.level.current=conf.level.start;conf.size.current=conf.size.start;conf.gap.current=conf.level.end;conf.time.current=conf.time.max;conf.combo.max=0;conf.combo.current=0;conf.score=0;$("div.panel").css({height:conf.tiles.width-5+"px",width:conf.tiles.width-5+"px"});update_status()}function get_title(c){var b=conf.title[0][1];var c=parseInt(c);for(var a in conf.title){if(c>=conf.title[a][0]){b=conf.title[a][1]}}return b}function update_status(){$("strong.score, span.score").text(conf.score);$("#time").text(conf.time.current);$("#timer").find("progress").attr({value:conf.time.current,max:conf.time.max});$("span.title").text(get_title(conf.score));$("span.combo").text(conf.combo.max)}function log(a){if(conf.debug){console.log(a)}}function render(b,m){function j(){return Math.floor(Math.random()*(255-conf.level.end*2))+conf.level.end}function g(){var o=j();var n=j();var i=j();var s=conf.gap.current;var q,p;if(Math.random()>0.5){q=d(o,n,i);p=d(o+s,n+s,i+s)}else{p=d(o,n,i);q=d(o+s,n+s,i+s)}return{base:q,answer:p}}function d(o,n,i){o=("00"+o.toString(16)).substr(-2);n=("00"+n.toString(16)).substr(-2);i=("00"+i.toString(16)).substr(-2);return"#"+o+n+i}function f(){conf.gap.current=(conf.level.end+1)-b;if(conf.gap.current<conf.gap.min){conf.gap.current=conf.gap.min}}var l=Math.floor((conf.tiles.width-conf.tiles.margin*m)/m);var e=m*m;f();var a=g();var c=Math.floor(Math.random()*e);conf.tiles.content.find(".answer").removeClass("answer");var k=conf.tiles.content.find(".tile").size();for(var h=k;h<e;h++){conf.tiles.content.append('<div class="tile"/>')}$("#tiles > div.tile").css({width:l+"px",height:l+"px",backgroundColor:a.base});$("#tiles > div.tile").eq(c).css("background-color",a.answer).addClass("answer")}var stage=new function(){this.run=d;function d(e){update_status();render(conf.level.current,conf.size.current);if(e==="hold"){return false}conf.level.current++;conf.size.current=Math.min(conf.size.end,++conf.size.current)}function b(e){conf.score++;d();log("right!");new c(true,e)}function a(e){log("wrong!");new c(false,e)}function c(g,e){var f=$('<div class="hit"/>');if(g){conf.combo.current++;f.text("+"+conf.combo.current);conf.combo.max=Math.max(conf.combo.current,conf.combo.max)}else{conf.combo.current=0;f.text("땡").addClass("wrong")}f.css({width:e.width()+"px",lineHeight:e.height()+"px"});e.append(f);f.fadeOut(500,function(){$(this).remove()})}this.tile_click=function(f){f.stopPropagation();f.preventDefault();$(this).hasClass("answer")?b($(this)):a($(this));log("score : "+conf.score)}};init();var game=new function(){function a(){log("game reset");$("#start").show();$("#end").hide();init();timer.stop()}this.start=function(){a();log("game start");$("#start").hide();stage.run();timer.start()};this.end=function(){log("game end");$("#end").show()};this.reset=a;$("#tiles").on("touchstart click","div.tile",stage.tile_click)};$("div.panel").on("click","button.start",game.start);$(window).resize(game.reset);var timer=new function(){var a;function b(){conf.time.current--;update_status();if(conf.time.current<=0){game.end()}else{a=setTimeout(b,1000)}}this.start=function(){b()};this.stop=function(){clearTimeout(a)}};function get_share_desc(){return conf.score+"점(연속+"+conf.combo.max+") 획득! 당신은 "+get_title(conf.score)+"!!"}$("#kakaostory-share").on("click",executeKakaoStoryLink);function executeKakaoStoryLink(){var b=$('meta[name="description"]').attr("content");var a=$('meta[name="title"]').attr("content");kakao.link("story").send({post:"틀린 타일 찾기! "+get_share_desc()+" - http://colortile.github.io/",appid:"colortile.github.io",appver:"1.0",appname:a,urlinfo:JSON.stringify({title:a,desc:b,imageurl:["http://colortile.github.io/static/images/apple-touch-icon-144x144.png"],type:"website"})})};